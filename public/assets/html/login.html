<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZonaUTP - Iniciar Sesión</title>
    <link rel="stylesheet" href="/public/assets/css/login.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="../img/LogoPrincipal.png" />
  </head>
  <body>
    <div class="login-container">
      <div class="login-card">
        <div class="login-header">
          <div class="logo-container">
            <img src="../img/LogoPrincipal.png" alt="Logo UTP" class="logo" />
          </div>
        </div>
        <form class="login-form" id="loginForm">
          <div class="form-group">
            <label class="custom-checkbox">
              <input type="checkbox" id="esEstudianteUTP" checked />
              <span class="checkmark"></span>
              ¿Eres estudiante de la universidad?
            </label>
          </div>

          <div class="form-group" id="grupoIdentidad">
            <label for="identidad" id="labelIdentidad"
              >Correo Institucional</label
            >
            <div class="input-container" id="inputIdentidadContainer">
              <i class="fas fa-envelope input-icon" id="iconoIdentidad"></i>
              <input
                type="email"
                id="identidad"
                name="email"
                placeholder="usuario@utp.ac.pa"
                required
                autocomplete="email"
              />
            </div>
            <!-- <div id="emailError" class="error-message"></div> -->
          </div>

          <div class="form-group">
            <label for="password">Contraseña</label>
            <div class="input-container">
              <i class="fas fa-lock input-icon"></i>
              <input
                type="password"
                id="password"
                name="password"
                placeholder="•••••"
                required
                autocomplete="current-password"
              />
            </div>
          </div>

          <div class="form-options">
            <label
              class="custom-checkbox"
              style="cursor: pointer; user-select: none"
            >
              <i
                class="fas fa-eye-slash toggle-password"
                id="togglePassword"
                style="margin-right: 8px"
              ></i>
              Mostrar contraseña
            </label>
            <a href="recuperar_contra.html" class="forgot-password"
              >¿Olvidaste tu contraseña?</a
            >
          </div>

          <button type="submit" class="login-button" id="loginButton">
            <span class="button-text">Iniciar Sesión</span>
            <i class="fas fa-arrow-right button-icon"></i>
          </button>
          <!-- Botón Google debajo de Iniciar Sesión -->
          <div id="googleBtnBlock" style="display:none; margin-top:10px;">
            <button
              type="button"
              id="googleLoginBtn"
              class="google-btn"
              style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                width: 100%;
                background: #fff;
                border: 1.5px solid #e2e8f0;
                border-radius: 8px;
                padding: 10px 0;
                font-weight: 600;
                color: #334155;
                font-size: 0.98em;
                cursor: pointer;
                transition: box-shadow 0.2s;
                min-height: 44px;
              "
            >
              <i class="fab fa-google" style="color: #ea4335; font-size: 1.1em"></i>
              Iniciar sesión con Google
            </button>
          </div>
        </form>
        <div class="login-footer">
          <p>
            ¿No tienes cuenta?
            <a href="registro_usuario.html" class="register-link">Regístrate aquí</a>
          </p>
          <p class="university-info">Universidad Tecnológica de Panamá</p>
        </div>
      </div>
    </div>

    <script src="../js/login.js"></script>
    <div id="errorModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close-modal" id="closeModal">&times;</span>
        <p id="modalMessage"></p>
      </div>
    </div>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
      import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAXsyFcYCIqk_k_pHLTwoPSDEzd_RdFlUc",
        authDomain: "ecommerce-utp.firebaseapp.com",
        projectId: "ecommerce-utp",
        storageBucket: "ecommerce-utp.firebasestorage.app",
        messagingSenderId: "49844622966",
        appId: "1:49844622966:web:5154fe4abb24614bea3157",
        measurementId: "G-01BMCL2E9P"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      // Google Auth
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      document.addEventListener('DOMContentLoaded', () => {
        // Mostrar/ocultar el botón de Google según el tipo de login
        const esEstudianteUTP = document.getElementById('esEstudianteUTP');
        const googleBtnBlock = document.getElementById('googleBtnBlock');
        if (googleBtnBlock && esEstudianteUTP) {
          googleBtnBlock.style.display = esEstudianteUTP.checked ? 'none' : 'block';
          esEstudianteUTP.addEventListener('change', function () {
            googleBtnBlock.style.display = this.checked ? 'none' : 'block';
          });
        }
        const googleBtn = document.getElementById('googleLoginBtn');
        if (googleBtn) {
          googleBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
              const result = await signInWithPopup(auth, provider);
              const user = result.user;
              window.location.href = "login.html";
            } catch (error) {
              alert('Error de autenticación con Google: ' + error.message);
            }
          });
        }
      });
    </script>
  </body>
</html>